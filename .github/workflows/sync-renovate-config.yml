name: Sync Renovate Config

on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:
  push:
    branches:
      - main
    paths:
      - '.github/renovate.json'

jobs:
    SyncRenovateConfig:
        name: Sync Renovate Config
        runs-on: ubuntu-latest
        steps:
          - name: Generate app token
            uses: actions/create-github-app-token@v2
            id: app-token
            with:
                app-id: ${{ vars.APP_ID }}
                private-key: ${{ secrets.APP_PRIVATE_KEY }}
                permission-contents: write

          - name: Checkout Core labels
            uses: actions/checkout@v4
            with:
              token: ${{ steps.app-token.outputs.token }}
            
          - name: Copy renovate config to root
            run: |
              cp .github/renovate.json yuanstuffs-renovate.json
          
          - name: Commit files
            run: |
              git config --local user.email "yuan-utilities[bot]@users.noreply.github.com"
              git config --local user.name "yuan-utilities[bot]"
              git commit -a -m "chore(renovate): sync config"

          - name: Push changes
            uses: ad-m/github-push-action@v0.8.0
            with:
              github_token: ${{ steps.app-token.outputs.token }}          
